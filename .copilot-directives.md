# Copilot Agent Directives

**Important**: These directives must be followed for all work on this project.

## Server Management

### Always Use start_server Script

**CRITICAL**: When starting the Django development server, ALWAYS use the `start_server` script:

```bash
./start_server
```

**Never use** `python manage.py runserver` directly. The `start_server` script ensures:
- Virtual environment is activated
- Port 8080 is used consistently  
- `uv` is in PATH
- Proper error handling
- We continuously test the script itself

**Rationale**: By always using the `start_server` script, we ensure it stays working and catches any issues with the setup process.

## Package Management

- **ONLY use `uv`** for Python package management
- Install dependencies: `uv pip install -e ".[dev]"`
- Never use `pip` directly

## Script Convention

### Shell Scripts
- All shell scripts MUST be created **without the `.sh` extension**
- Examples: `setup`, `start_server`, `deploy` (not `setup.sh`, `start_server.sh`, etc.)
- Make executable: `chmod +x scriptname`
- Use shebang: `#!/usr/bin/env bash`

### Python Scripts
- All standalone Python scripts MUST be created **without the `.py` extension**
- Examples: `generate_load`, `migrate_data` (not `generate_load.py`, `migrate_data.py`)
- Make executable: `chmod +x scriptname`
- Use shebang: `#!/usr/bin/env python3`
- Rationale: Cleaner command-line interface, consistent with Unix conventions

## Development Workflow

Before any PR creation, ensure:
1. Implementation Agent completes changes
2. Primary Critique Agent (Claude) reviews
3. Secondary Critique Agent (GPT-5) reviews independently
4. Testing Agent ensures comprehensive coverage
5. VS Code Problems panel is clear (no errors)
6. Tests run without warnings
7. All agents confirm approval

## Git and Branch Management

### MANDATORY: Use Graphite CLI Only

**CRITICAL**: NEVER use raw git commands for commits, branches, or PR workflow. Use Graphite CLI (`gt`) exclusively.

**Forbidden commands** (NEVER use these):
- ❌ `git add` - use `gt create --all` or `gt modify --all` instead
- ❌ `git commit` - use `gt create --all --message "msg"` or `gt modify --all --message "msg"`
- ❌ `git push` - use `gt submit --no-interactive`
- ❌ `git checkout -b` - use `gt create --all --message "msg"`
- ❌ `git branch -d` - use `gt delete` or let Graphite auto-cleanup

**Required Graphite commands**:
- ✅ Create branch + commit: `GRAPHITE_PROFILE=thehcma gt create --all --message "feat: description"`
- ✅ Amend commit: `GRAPHITE_PROFILE=thehcma gt modify --all --message "updated message"`
- ✅ Submit PR: `GRAPHITE_PROFILE=thehcma gt submit --no-interactive`
- ✅ Sync with remote: `GRAPHITE_PROFILE=thehcma gt sync --force`
- ✅ View stack: `GRAPHITE_PROFILE=thehcma gt log short`

**Read-only git commands are OK** (for viewing status):
- ✅ `git status`, `git log`, `git diff`, `git branch -a`

**Rationale**: Graphite ensures clean PR stacking, consistent workflow, and automatic branch cleanup.

## Testing

- Always run tests before committing: `pytest`
- Achieve 90%+ code coverage
- Include randomized tests for all implementations
