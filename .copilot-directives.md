# Copilot Agent Directives

**Important**: These directives must be followed for all work on this project.

## Server Management

### Always Use my-tracks-server Script

**CRITICAL**: When starting the development server, ALWAYS use the `my-tracks-server` script:

```bash
./my-tracks-server
```

**Never use** `python manage.py runserver` directly. The `my-tracks-server` script ensures:
- Virtual environment is activated
- Port 8080 is used consistently
- `uv` is in PATH
- Proper error handling
- We continuously test the script itself
- Dual logging mode with `--console` flag (outputs to both console AND file)

**Rationale**: By always using the `my-tracks-server` script, we ensure it stays working and catches any issues with the setup process.

## Package Management

- **ONLY use `uv`** for Python package management
- Install dependencies: `uv pip install -e ".[dev]"`
- Never use `pip` directly

## Script Convention

### Shell Scripts
- All shell scripts MUST be created **without the `.sh` extension**
- Examples: `setup`, `my-tracks-server`, `deploy` (not `setup.sh`, `my-tracks-server.sh`, etc.)
- Make executable: `chmod +x scriptname`
- Use shebang: `#!/usr/bin/env bash`

### Python Scripts
- All standalone Python scripts MUST be created **without the `.py` extension**
- Examples: `generate_load`, `migrate_data` (not `generate_load.py`, `migrate_data.py`)
- Make executable: `chmod +x scriptname`
- Use shebang: `#!/usr/bin/env python3`
- Rationale: Cleaner command-line interface, consistent with Unix conventions

## Development Workflow

Before any PR creation, ensure:
1. Implementation Agent completes changes
2. Primary Critique Agent (Claude) reviews
3. Secondary Critique Agent (GPT-5) reviews independently
4. Testing Agent ensures comprehensive coverage
5. VS Code Problems panel is clear (no errors)
6. Tests run without warnings
7. All agents confirm approval

## Git and Branch Management

### MANDATORY: Use Graphite CLI (`gt`) for Version Control

**CRITICAL**: Use Graphite CLI (`gt`) for all version control operations.

**Why Graphite?**
- PR stacking with automatic rebasing
- Branch cleanup on PR merge
- Consistent workflow across the team
- Many git commands pass through (e.g., `gt status`, `gt diff`, `gt fetch`)

**Graphite-specific commands** (enhanced workflow):
- ✅ Create branch + commit: `GRAPHITE_PROFILE=thehcma gt create --all --message "feat: description"`
- ✅ Amend commit: `GRAPHITE_PROFILE=thehcma gt modify --all --message "updated message"`
- ✅ Submit PR: `GRAPHITE_PROFILE=thehcma gt submit --no-interactive`
- ✅ Sync with remote: `GRAPHITE_PROFILE=thehcma gt sync --force`
- ✅ View stack: `GRAPHITE_PROFILE=thehcma gt log short`
- ✅ Switch branches: `gt checkout <branch>` or `gt up`/`gt down`

**Git passthrough commands** (work via gt):
- ✅ `gt status` - check working tree status
- ✅ `gt diff` - view changes
- ✅ `gt fetch --prune` - fetch and prune remote branches
- ✅ `gt add`, `gt reset`, `gt restore`, `gt rebase`, `gt cherry-pick`

**Commands that require native git** (gt has different behavior):
- Use `git log --oneline -10` for commit history (gt log shows stack)
- Use `git branch -a` to list all branches (gt branch is subcommand)

**Rationale**: Graphite ensures clean PR stacking, consistent workflow, and automatic branch cleanup.

## Testing

- Always run tests before committing: `pytest`
- Achieve 90%+ code coverage
- Include randomized tests for all implementations
